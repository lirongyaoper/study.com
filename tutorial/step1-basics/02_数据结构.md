# 第二章：数据结构详解 🗂️

## PHP中的树形数据表示

在PHP中，我们通常使用二维数组来表示树形数据。让我们从简单的例子开始理解。

## 基本数据格式

### 标准格式

```php
$data = array(
    1 => array('id' => 1, 'parentid' => 0, 'name' => '电子产品'),
    2 => array('id' => 2, 'parentid' => 1, 'name' => '手机'),
    3 => array('id' => 3, 'parentid' => 1, 'name' => '电脑'),
    4 => array('id' => 4, 'parentid' => 2, 'name' => 'iPhone'),
    5 => array('id' => 5, 'parentid' => 2, 'name' => '华为手机'),
    6 => array('id' => 6, 'parentid' => 3, 'name' => '笔记本电脑')
);
```

### 字段说明

- **id**: 唯一标识符，每个节点都有一个唯一的ID
- **parentid**: 父节点的ID，根节点的parentid为0
- **name**: 节点的显示名称

### 数据关系图

让我们用图表来展示这些数据的关系：

```
数据ID: 1, parentid: 0, name: "电子产品"     ← 根节点
    ├── 数据ID: 2, parentid: 1, name: "手机"      ← 第一个子节点
    │   ├── 数据ID: 4, parentid: 2, name: "iPhone"     ← 叶子节点
    │   └── 数据ID: 5, parentid: 2, name: "华为手机"   ← 叶子节点
    └── 数据ID: 3, parentid: 1, name: "电脑"      ← 第二个子节点
        └── 数据ID: 6, parentid: 3, name: "笔记本电脑" ← 叶子节点
```

## 实际应用中的数据示例

### 1. 网站菜单数据

```php
$menu_data = array(
    1 => array('id' => 1, 'parentid' => 0, 'name' => '首页', 'url' => '/'),
    2 => array('id' => 2, 'parentid' => 0, 'name' => '产品', 'url' => '/products'),
    3 => array('id' => 3, 'parentid' => 2, 'name' => '手机', 'url' => '/products/phone'),
    4 => array('id' => 4, 'parentid' => 2, 'name' => '电脑', 'url' => '/products/computer'),
    5 => array('id' => 5, 'parentid' => 3, 'name' => 'iPhone', 'url' => '/products/phone/iphone'),
    6 => array('id' => 6, 'parentid' => 3, 'name' => '安卓手机', 'url' => '/products/phone/android'),
    7 => array('id' => 7, 'parentid' => 0, 'name' => '关于我们', 'url' => '/about')
);
```

### 2. 部门组织架构

```php
$department_data = array(
    1 => array('id' => 1, 'parentid' => 0, 'name' => '总经理办', 'manager' => '张总'),
    2 => array('id' => 2, 'parentid' => 1, 'name' => '技术部', 'manager' => '李经理'),
    3 => array('id' => 3, 'parentid' => 1, 'name' => '市场部', 'manager' => '王经理'),
    4 => array('id' => 4, 'parentid' => 2, 'name' => '开发组', 'manager' => '赵组长'),
    5 => array('id' => 5, 'parentid' => 2, 'name' => '测试组', 'manager' => '钱组长'),
    6 => array('id' => 6, 'parentid' => 4, 'name' => '前端开发', 'manager' => '小张'),
    7 => array('id' => 7, 'parentid' => 4, 'name' => '后端开发', 'manager' => '小李')
);
```

### 3. 地区分级数据

```php
$region_data = array(
    1 => array('id' => 1, 'parentid' => 0, 'name' => '中国', 'type' => 'country'),
    2 => array('id' => 2, 'parentid' => 1, 'name' => '北京市', 'type' => 'province'),
    3 => array('id' => 3, 'parentid' => 1, 'name' => '上海市', 'type' => 'province'),
    4 => array('id' => 4, 'parentid' => 2, 'name' => '海淀区', 'type' => 'district'),
    5 => array('id' => 5, 'parentid' => 2, 'name' => '朝阳区', 'type' => 'district'),
    6 => array('id' => 6, 'parentid' => 3, 'name' => '浦东新区', 'type' => 'district')
);
```

## 数据的基本特征

### 1. 必需字段

- **id**: 必须唯一，通常是整数
- **parentid**: 指向父节点的ID，根节点为0

### 2. 可选字段

根据实际需要可以添加更多字段：
- **name**: 显示名称
- **sort_order**: 排序字段
- **url**: 链接地址（菜单类型）
- **type**: 类型标识
- **status**: 状态（启用/禁用）
- **description**: 描述信息

### 3. 数据规则

- 根节点的parentid必须为0
- 每个非根节点必须有一个有效的parentid
- 不能出现循环引用（A的父节点是B，B的父节点又是A）
- 删除节点时要考虑其子节点的处理

## 从数据库获取数据

在实际项目中，树形数据通常来自数据库：

```php
// 从数据库获取数据的示例
function getTreeDataFromDB() {
    $pdo = new PDO($dsn, $username, $password);
    $sql = "SELECT id, parentid, name, sort_order FROM categories ORDER BY sort_order";
    $stmt = $pdo->query($sql);
    
    $data = array();
    while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
        $data[$row['id']] = $row;
    }
    
    return $data;
}
```

## 数据验证

为了确保数据的正确性，我们需要进行一些基本验证：

```php
function validateTreeData($data) {
    $errors = array();
    
    foreach ($data as $id => $item) {
        // 检查必需字段
        if (!isset($item['id']) || !isset($item['parentid'])) {
            $errors[] = "ID {$id}: 缺少必需字段";
        }
        
        // 检查父节点是否存在（除了根节点）
        if ($item['parentid'] != 0 && !isset($data[$item['parentid']])) {
            $errors[] = "ID {$id}: 父节点 {$item['parentid']} 不存在";
        }
        
        // 检查是否自己引用自己
        if ($item['id'] == $item['parentid']) {
            $errors[] = "ID {$id}: 不能引用自己作为父节点";
        }
    }
    
    return $errors;
}
```

## 常见问题及解决方案

### 问题1：数据排序

**问题**：如何确保同级节点按指定顺序排列？

**解决方案**：添加sort_order字段，在获取数据时按此字段排序。

### 问题2：无限级分类

**问题**：如何处理层级很深的分类？

**解决方案**：Tree类会递归处理，理论上支持无限级。

### 问题3：性能优化

**问题**：数据量大时查询慢怎么办？

**解决方案**：
1. 在数据库中为parentid字段建立索引
2. 使用缓存机制
3. 考虑使用其他树形存储模型（如嵌套集模型）

## 下一步学习

现在你已经了解了树形数据的结构，接下来我们将学习：
1. Tree类的核心方法
2. 如何操作这些数据
3. 如何生成各种格式的输出

继续阅读 [`03_核心方法.md`](03_核心方法.md) 来学习Tree类的具体使用方法！
