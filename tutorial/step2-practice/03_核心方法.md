# 第三章：Tree类核心方法详解 🔧

## 方法概览

SimpleTree类提供了以下核心方法来处理树形数据：

| 方法名 | 功能 | 难度 |
|--------|------|------|
| `init()` | 初始化数据 | ⭐ |
| `getChildren()` | 获取子节点 | ⭐ |
| `getParent()` | 获取父节点 | ⭐ |
| `getAllDescendants()` | 获取所有子孙节点 | ⭐⭐ |
| `generateTreeText()` | 生成树形文本 | ⭐⭐⭐ |
| `isLeaf()` | 判断是否为叶子节点 | ⭐ |
| `getRoots()` | 获取根节点 | ⭐ |
| `getDepth()` | 计算节点深度 | ⭐⭐ |

## 1. init() - 数据初始化 ⭐

### 功能说明
设置Tree类要处理的数据，这是使用Tree类的第一步。

### 语法
```php
public function init($data = array())
```

### 参数
- `$data` (array): 树形数据的二维数组

### 返回值
- `boolean`: 成功返回true，失败返回false

### 使用示例
```php
$tree = new SimpleTree();

// 准备数据
$data = array(
    1 => array('id' => 1, 'parentid' => 0, 'name' => '根节点'),
    2 => array('id' => 2, 'parentid' => 1, 'name' => '子节点')
);

// 初始化
$result = $tree->init($data);
if ($result) {
    echo "数据初始化成功！";
} else {
    echo "数据初始化失败！";
}
```

### 注意事项
- 数据必须是数组格式
- 每个数组元素必须包含`id`和`parentid`字段
- 建议在使用其他方法前先调用此方法

---

## 2. getChildren() - 获取子节点 ⭐

### 功能说明
获取指定节点的所有直接子节点，这是最常用的方法之一。

### 语法
```php
public function getChildren($parent_id)
```

### 参数
- `$parent_id` (int): 父节点的ID

### 返回值
- `array`: 子节点数组（如果有子节点）
- `false`: 没有子节点时返回false

### 使用示例
```php
// 获取ID为1的节点的所有子节点
$children = $tree->getChildren(1);

if ($children) {
    echo "找到 " . count($children) . " 个子节点：\n";
    foreach ($children as $child) {
        echo "- " . $child['name'] . "\n";
    }
} else {
    echo "没有找到子节点\n";
}
```

### 实际应用
```php
// 生成下拉菜单选项
function generateOptions($tree, $parent_id) {
    $html = '';
    $children = $tree->getChildren($parent_id);
    
    if ($children) {
        foreach ($children as $child) {
            $html .= "<option value='{$child['id']}'>{$child['name']}</option>\n";
        }
    }
    
    return $html;
}
```

---

## 3. getParent() - 获取父节点 ⭐

### 功能说明
获取指定节点的父节点信息。

### 语法
```php
public function getParent($node_id)
```

### 参数
- `$node_id` (int): 节点ID

### 返回值
- `array`: 父节点信息（如果有父节点）
- `false`: 是根节点或节点不存在时返回false

### 使用示例
```php
// 获取ID为4的节点的父节点
$parent = $tree->getParent(4);

if ($parent) {
    echo "父节点是: " . $parent['name'];
} else {
    echo "这是根节点或节点不存在";
}
```

### 实际应用
```php
// 生成面包屑导航
function generateBreadcrumb($tree, $node_id) {
    $path = array();
    $current_id = $node_id;
    
    // 向上追溯到根节点
    while ($current_id != 0) {
        if (isset($tree->data[$current_id])) {
            array_unshift($path, $tree->data[$current_id]);
            $current_id = $tree->data[$current_id]['parentid'];
        } else {
            break;
        }
    }
    
    return $path;
}
```

---

## 4. getAllDescendants() - 获取所有子孙节点 ⭐⭐

### 功能说明
递归获取指定节点下的所有子孙节点（不仅仅是直接子节点）。

### 语法
```php
public function getAllDescendants($parent_id)
```

### 参数
- `$parent_id` (int): 父节点ID

### 返回值
- `array`: 所有子孙节点的数组

### 递归原理图解
```
getAllDescendants(1) 的执行过程：

1. 获取节点1的直接子节点: [2, 3]
2. 处理节点2:
   - 添加节点2到结果
   - 递归调用 getAllDescendants(2)
   - 获取节点2的子节点: [4, 5]
   - 添加节点4, 5到结果
3. 处理节点3:
   - 添加节点3到结果
   - 递归调用 getAllDescendants(3)
   - 获取节点3的子节点: [6]
   - 添加节点6到结果

最终结果: [2, 4, 5, 3, 6]
```

### 使用示例
```php
// 获取所有子孙节点
$descendants = $tree->getAllDescendants(1);

echo "节点1的所有子孙节点：\n";
foreach ($descendants as $node) {
    echo "- " . $node['name'] . "\n";
}
```

### 实际应用
```php
// 删除分类时，同时删除所有子分类
function deleteCategory($tree, $category_id) {
    $to_delete = array($category_id);
    
    // 获取所有子孙节点ID
    $descendants = $tree->getAllDescendants($category_id);
    foreach ($descendants as $descendant) {
        $to_delete[] = $descendant['id'];
    }
    
    // 批量删除
    foreach ($to_delete as $id) {
        // 执行删除操作
        echo "删除分类 ID: $id\n";
    }
}
```

---

## 5. generateTreeText() - 生成树形文本 ⭐⭐⭐

### 功能说明
生成美观的树形文本结构，用于在控制台或网页上显示。

### 语法
```php
public function generateTreeText($parent_id = 0, $prefix = '')
```

### 参数
- `$parent_id` (int): 起始节点ID（默认为0，表示从根节点开始）
- `$prefix` (string): 前缀字符串（递归使用，外部调用时不需要设置）

### 返回值
- `string`: 格式化的树形文本字符串

### 输出格式说明
```
电子产品
├── 手机
│   ├── iPhone
│   └── 华为手机
└── 电脑
    ├── 笔记本电脑
    └── 台式电脑
```

**符号说明：**
- `├──`: 表示有兄弟节点的子节点
- `└──`: 表示最后一个子节点
- `│`: 表示上级还有兄弟节点，需要连接线
- `空格`: 表示上级没有兄弟节点了

### 使用示例
```php
// 生成完整的树形结构
echo $tree->generateTreeText();

// 从指定节点开始生成
echo "手机分类下的结构：\n";
echo $tree->generateTreeText(2);
```

### 算法原理
```php
// 简化的算法逻辑
function generateTreeText($parent_id, $prefix) {
    $children = getChildren($parent_id);
    $result = '';
    
    for ($i = 0; $i < count($children); $i++) {
        $child = $children[$i];
        $is_last = ($i == count($children) - 1);
        
        if ($is_last) {
            $current_prefix = $prefix . '└── ';
            $next_prefix = $prefix . '    ';  // 空格，因为是最后一个
        } else {
            $current_prefix = $prefix . '├── ';
            $next_prefix = $prefix . '│   ';  // 竖线，还有兄弟节点
        }
        
        $result .= $current_prefix . $child['name'] . "\n";
        $result .= generateTreeText($child['id'], $next_prefix);
    }
    
    return $result;
}
```

---

## 6. 辅助方法详解

### isLeaf() - 判断叶子节点
```php
// 检查节点是否为叶子节点
if ($tree->isLeaf(4)) {
    echo "这是叶子节点，可以放置内容";
} else {
    echo "这是分支节点，包含子节点";
}
```

### getRoots() - 获取根节点
```php
// 获取所有根节点
$roots = $tree->getRoots();
foreach ($roots as $root) {
    echo "根节点: " . $root['name'] . "\n";
}
```

### getDepth() - 计算深度
```php
// 计算节点深度（用于缩进控制）
$depth = $tree->getDepth(4);
$indent = str_repeat('  ', $depth - 1);
echo $indent . "节点名称";
```

## 实践建议

1. **从简单开始**：先掌握`getChildren()`和`getParent()`
2. **理解递归**：重点理解`getAllDescendants()`的递归逻辑
3. **调试技巧**：使用`printData()`方法查看数据结构
4. **实际应用**：结合具体场景练习这些方法

## 下一步学习

现在你已经了解了所有核心方法，接下来：
1. 运行 `examples/basic_usage.php` 查看实际使用
2. 完成 `exercises/exercise_01.php` 练习
3. 阅读 [`04_实战应用.md`](04_实战应用.md) 了解更多应用场景

继续你的Tree类学习之旅！🚀
